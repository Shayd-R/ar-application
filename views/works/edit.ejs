<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <style>
    .preview-image {
      max-height: 200px;
      object-fit: contain;
    }
    .select2-container {
      width: 100% !important;
    }
    .tab-content {
      padding: 20px;
      border: 1px solid #dee2e6;
      border-top: none;
      border-radius: 0 0 .25rem .25rem;
    }
  </style>
</head>
<body>
  <%- include('../partials/navbar') %>
  
  <div class="container mt-4">
    <%- include('../partials/messages') %>
    
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1><i class="fas fa-edit"></i> Editar Obra</h1>
      <a href="/works/<%= work.id_work %>" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left"></i> Volver
      </a>
    </div>

    <form action="/works/<%= work.id_work %>" method="POST" enctype="multipart/form-data">
      <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" data-bs-toggle="tab" href="#basic" role="tab">
            <i class="fas fa-info-circle"></i> Información Básica
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-bs-toggle="tab" href="#media" role="tab">
            <i class="fas fa-images"></i> Multimedia
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-bs-toggle="tab" href="#links" role="tab">
            <i class="fas fa-link"></i> Enlaces
          </a>
        </li>
      </ul>

      <div class="tab-content">
        <!-- Pestaña de Información Básica -->
        <div class="tab-pane fade show active" id="basic" role="tabpanel">
          <div class="row">
            <div class="col-md-8">
              <div class="mb-3">
                <label class="form-label">Título *</label>
                <input type="text" class="form-control" name="title" value="<%= work.title_work %>" required>
              </div>

              <div class="mb-3">
                <label class="form-label">Descripción *</label>
                <textarea class="form-control" name="description" rows="4" required><%= work.description_work %></textarea>
              </div>

              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Categoría</label>
                    <select class="form-select" name="id_category">
                      <option value="">-- Seleccionar --</option>
                      <% categories.forEach(category => { %>
                        <option value="<%= category.id_category %>" 
                          <%= work.id_category === category.id_category ? 'selected' : '' %>>
                          <%= category.name_category %>
                        </option>
                      <% }) %>
                    </select>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Estado</label>
                    <div class="form-check">
                      <input type="radio" class="form-check-input" name="status" value="activa" 
                        <%= work.status_work === 'activa' ? 'checked' : '' %>>
                      <label class="form-check-label">Activa</label>
                    </div>
                    <div class="form-check">
                      <input type="radio" class="form-check-input" name="status" value="inactiva"
                        <%= work.status_work === 'inactiva' ? 'checked' : '' %>>
                      <label class="form-check-label">Inactiva</label>
                    </div>
                  </div>
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label">Etiquetas</label>
                <select class="form-control select2-tags" name="tags[]" multiple>
                  <% tags.forEach(tag => { %>
                    <option value="<%= tag.id_tag %>" 
                      <%= workTags.some(wt => wt.id_tag === tag.id_tag) ? 'selected' : '' %>>
                      <%= tag.name_tag %>
                    </option>
                  <% }) %>
                </select>
              </div>
            </div>

            <div class="col-md-4">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">Contenido Principal <span class="text-danger">*</span></h5>
                  <% if (work.url_image_work) { %>
                    <% if (work.content_type === 'video') { %>
                      <div id="mainContentPreview">
                        <video src="<%= work.url_image_work %>" class="preview-content mb-3" controls style="max-width: 100%;"></video>
                      </div>
                    <% } else { %>
                      <div id="mainContentPreview">
                        <img src="<%= work.url_image_work %>" class="preview-content mb-3" alt="Contenido principal" style="max-width: 100%;">
                      </div>
                    <% } %>
                    <div class="d-flex mb-2">
                      <button type="button" class="btn btn-danger btn-sm" id="deleteMainContent" data-image="<%= work.url_image_work %>" data-id="<%= work.id_work %>" data-type="main">
                        <i class="fas fa-trash"></i> Eliminar y Reemplazar
                      </button>
                      <small class="text-danger ms-2">* Es obligatorio tener contenido principal</small>
                    </div>
                  <% } else { %>
                    <div class="alert alert-warning mb-3">
                      <i class="fas fa-exclamation-triangle me-2"></i> No hay contenido principal
                      <small class="d-block mt-1 text-danger">* Es obligatorio agregar contenido principal para compartir el QR</small>
                    </div>
                  <% } %>
                  <div>
                    <input type="file" class="form-control" name="mainContent" id="mainContentBasic" accept="image/*,video/*" <%= !work.url_image_work ? 'required' : '' %>>
                    <small class="text-muted">Máximo 100MB. Formatos imagen: JPG, PNG, GIF, WEBP. Formatos video: MP4, WEBM</small>
                  </div>
                </div>
              </div>

              <!-- Target File Section -->
              <div class="card mt-3">
                <div class="card-body">
                  <h5 class="card-title">Archivo Target <span class="text-danger">*</span></h5>
                  <% if (work.url_target_work) { %>
                    <div class="d-flex align-items-center mb-3" id="targetPreview">
                      <i class="fas fa-file-alt fa-2x me-2"></i>
                      <span><%= work.url_target_work.split('/').pop() %></span>
                    </div>
                    <div class="d-flex mb-2">
                      <button type="button" class="btn btn-danger btn-sm" id="deleteTarget" data-target="<%= work.url_target_work %>" data-id="<%= work.id_work %>">
                        <i class="fas fa-trash"></i> Eliminar y Reemplazar
                      </button>
                      <small class="text-danger ms-2">* Es obligatorio tener un archivo target</small>
                    </div>
                  <% } else { %>
                    <div class="alert alert-warning mb-3">
                      <i class="fas fa-exclamation-triangle me-2"></i> No hay archivo target
                      <small class="d-block mt-1 text-danger">* Es obligatorio agregar un archivo target</small>
                    </div>
                  <% } %>
                  <div>
                    <input type="file" class="form-control" name="targetFile" id="targetFile" accept=".mind" <%= !work.url_target_work ? 'required' : '' %>>
                    <small class="text-muted">Archivo target generado por Mind AR. Formato: .mind</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Pestaña de Multimedia -->
        <div class="tab-pane fade" id="media" role="tabpanel">
          <div class="row">
            <div class="col-md-12 mb-4">
              <h5>Contenido Principal</h5>
              <div class="card">
                <div class="card-body">
                  <% if (work.url_image_work) { %>
                    <% if (work.content_type === 'video') { %>
                      <video src="<%= work.url_image_work %>" class="img-fluid preview-image mb-3" controls></video>
                    <% } else { %>
                      <img src="<%= work.url_image_work %>" class="img-fluid preview-image mb-3" alt="Contenido principal">
                    <% } %>
                    <div class="d-flex mb-2">
                      <button type="button" class="btn btn-danger btn-sm delete-image" data-image="<%= work.url_image_work %>" data-id="<%= work.id_work %>" data-type="main">
                        <i class="fas fa-trash"></i> Eliminar y Reemplazar
                      </button>
                      <small class="text-danger ms-2">* Es obligatorio tener contenido principal</small>
                    </div>
                  <% } else { %>
                    <div class="alert alert-warning mb-3">
                      <i class="fas fa-exclamation-triangle me-2"></i> No hay contenido principal
                      <small class="d-block mt-1 text-danger">* Es obligatorio agregar contenido principal para compartir el QR</small>
                    </div>
                  <% } %>
                  <input type="file" class="form-control" name="mainContent_readonly" id="mainContentMedia" accept="image/*,video/*" <%= !work.url_image_work ? 'required' : '' %> disabled>
                  <small class="text-muted">Máximo 100MB. Formatos imagen: JPG, PNG, GIF, WEBP. Formatos video: MP4, WEBM</small>
                  <p class="mt-2 text-info">
                    <i class="fas fa-info-circle"></i> Para cambiar el contenido principal, utiliza la sección "Información Básica"
                  </p>
                </div>
              </div>
            </div>

            <div class="col-md-12 mb-4">
              <h5>Archivo Target</h5>
              <div class="card">
                <div class="card-body">
                  <% if (work.url_target_work) { %>
                    <div class="d-flex align-items-center mb-3">
                      <i class="fas fa-file-alt fa-2x me-2"></i>
                      <span><%= work.url_target_work.split('/').pop() %></span>
                    </div>
                    <div class="d-flex mb-2">
                      <button type="button" class="btn btn-danger btn-sm delete-target" data-target="<%= work.url_target_work %>" data-id="<%= work.id_work %>">
                        <i class="fas fa-trash"></i> Eliminar y Reemplazar
                      </button>
                      <small class="text-danger ms-2">* Es obligatorio tener un archivo target</small>
                    </div>
                  <% } else { %>
                    <div class="alert alert-warning mb-3">
                      <i class="fas fa-exclamation-triangle me-2"></i> No hay archivo target
                      <small class="d-block mt-1 text-danger">* Es obligatorio agregar un archivo target</small>
                    </div>
                  <% } %>
                  <input type="file" class="form-control" name="targetFile" accept=".mind" <%= !work.url_target_work ? 'required' : '' %>>
                  <small class="text-muted">Archivo target generado por Mind AR. Formato: .mind</small>
                </div>
              </div>
            </div>

            <div class="col-md-12">
              <h5>Imágenes Adicionales</h5>
              <div class="card">
                <div class="card-body">
                  <div class="row" id="additionalImagesContainer">
                    <% if (additionalImages && additionalImages.length > 0) { %>
                      <% additionalImages.forEach(image => { %>
                        <div class="col-md-4 mb-3">
                          <div class="card">
                            <img src="<%= image.image_url %>" class="card-img-top preview-image" alt="Imagen adicional">
                            <div class="card-body">
                              <button type="button" class="btn btn-danger btn-sm delete-image" data-image="<%= image.image_url %>" data-id="<%= image.id_additional_image %>" data-type="additional">
                                <i class="fas fa-trash"></i> Eliminar
                              </button>
                            </div>
                          </div>
                        </div>
                      <% }) %>
                    <% } %>
                  </div>
                  <input type="file" class="form-control mt-3" name="additionalImages" multiple accept="image/*">
                  <small class="text-muted">Puedes seleccionar múltiples imágenes. Máximo 50MB por imagen.</small>
                </div>
              </div>
            </div>

            <div class="col-md-12">
              <h5>Videos</h5>
              <div class="card">
                <div class="card-body">
                  <ul class="nav nav-tabs" role="tablist">
                    <li class="nav-item">
                      <a class="nav-link active" data-bs-toggle="tab" href="#videoFiles" role="tab">Archivos de Video</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" data-bs-toggle="tab" href="#videoLinks" role="tab">Enlaces de Video</a>
                    </li>
                  </ul>

                  <div class="tab-content mt-3">
                    <div class="tab-pane fade show active" id="videoFiles" role="tabpanel">
                      <div id="videoFilesContainer">
                        <% if (videos && videos.length > 0) { %>
                          <% videos.forEach(video => { %>
                            <% if (video.video_type === 'file') { %>
                              <div class="mb-3">
                                <video class="video-preview" controls style="max-width: 100%; max-height: 200px;">
                                  <source src="<%= video.video_url %>" type="video/mp4">
                                  Tu navegador no soporta el elemento de video.
                                </video>
                                <button type="button" class="btn btn-danger btn-sm mt-2 delete-video" data-video="<%= video.video_url %>" data-id="<%= video.id_video %>">
                                  <i class="fas fa-trash"></i> Eliminar Video
                                </button>
                              </div>
                            <% } %>
                          <% }) %>
                        <% } %>
                      </div>
                      <input type="file" class="form-control mt-3" name="videoFiles" multiple accept="video/*">
                      <small class="text-muted">Formatos soportados: MP4, WEBM. Máximo 100MB por video.</small>
                    </div>

                    <div class="tab-pane fade" id="videoLinks" role="tabpanel">
                      <div id="videoLinksContainer">
                        <% if (videos && videos.length > 0) { %>
                          <% videos.forEach(video => { %>
                            <% if (video.video_type === 'link') { %>
                              <div class="input-group mb-3">
                                <input type="url" class="form-control" name="video_urls[]" value="<%= video.video_url %>" placeholder="URL del video">
                                <button type="button" class="btn btn-outline-danger delete-video" data-video="<%= video.video_url %>" data-id="<%= video.id_video %>">
                                  <i class="fas fa-times"></i>
                                </button>
                              </div>
                            <% } %>
                          <% }) %>
                        <% } %>
                      </div>
                      <button type="button" class="btn btn-outline-secondary btn-sm" id="addVideoLinkBtn">
                        <i class="fas fa-plus"></i> Añadir Enlace de Video
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Pestaña de Enlaces -->
        <div class="tab-pane fade" id="links" role="tabpanel">
          <div class="row">
            <div class="col-md-6">
              <h5>Enlaces Externos</h5>
              <div id="linksContainer">
                <% if (links && links.length > 0) { %>
                  <% links.forEach(link => { %>
                    <div class="input-group mb-3">
                      <input type="url" class="form-control" name="links[]" value="<%= link.link_url %>" placeholder="URL del enlace">
                      <button type="button" class="btn btn-outline-danger remove-btn">
                        <i class="fas fa-times"></i>
                      </button>
                    </div>
                  <% }) %>
                <% } else { %>
                  <div class="input-group mb-3">
                    <input type="url" class="form-control" name="links[]" placeholder="URL del enlace">
                  </div>
                <% } %>
              </div>
              <button type="button" class="btn btn-outline-secondary btn-sm" id="addLinkBtn">
                <i class="fas fa-plus"></i> Añadir Enlace
              </button>
            </div>

            <div class="col-md-6">
              <h5>Redes Sociales</h5>
              <div id="socialContainer">
                <% if (socialMedia && socialMedia.length > 0) { %>
                  <% socialMedia.forEach(social => { %>
                    <div class="social-item mb-3">
                      <div class="input-group">
                        <select class="form-select" name="social_platform[]" style="max-width: 150px;">
                          <option value="Instagram" <%= social.platform === 'Instagram' ? 'selected' : '' %>>Instagram</option>
                          <option value="Twitter" <%= social.platform === 'Twitter' ? 'selected' : '' %>>Twitter</option>
                          <option value="Facebook" <%= social.platform === 'Facebook' ? 'selected' : '' %>>Facebook</option>
                          <option value="TikTok" <%= social.platform === 'TikTok' ? 'selected' : '' %>>TikTok</option>
                          <option value="Pinterest" <%= social.platform === 'Pinterest' ? 'selected' : '' %>>Pinterest</option>
                          <option value="Behance" <%= social.platform === 'Behance' ? 'selected' : '' %>>Behance</option>
                          <option value="Otro" <%= social.platform === 'Otro' ? 'selected' : '' %>>Otro</option>
                        </select>
                        <input type="text" class="form-control" name="social_url[]" value="<%= social.handle_or_url %>" placeholder="@usuario o URL">
                        <button type="button" class="btn btn-outline-danger remove-btn">
                          <i class="fas fa-times"></i>
                        </button>
                      </div>
                    </div>
                  <% }) %>
                <% } else { %>
                  <div class="social-item mb-3">
                    <div class="input-group">
                      <select class="form-select" name="social_platform[]" style="max-width: 150px;">
                        <option value="Instagram">Instagram</option>
                        <option value="Twitter">Twitter</option>
                        <option value="Facebook">Facebook</option>
                        <option value="TikTok">TikTok</option>
                        <option value="Pinterest">Pinterest</option>
                        <option value="Behance">Behance</option>
                        <option value="Otro">Otro</option>
                      </select>
                      <input type="text" class="form-control" name="social_url[]" placeholder="@usuario o URL">
                    </div>
                  </div>
                <% } %>
              </div>
              <button type="button" class="btn btn-outline-secondary btn-sm" id="addSocialBtn">
                <i class="fas fa-plus"></i> Añadir Red Social
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="d-flex justify-content-between mt-4">
        <a href="/works/<%= work.id_work %>" class="btn btn-outline-secondary">
          <i class="fas fa-times"></i> Cancelar
        </a>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-save"></i> Guardar Cambios
        </button>
      </div>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  
  <script>
    $(document).ready(function() {
      // Inicializar Select2
      $('.select2-tags').select2({
        tags: true,
        tokenSeparators: [',', ' '],
        placeholder: 'Selecciona o crea etiquetas...',
        language: {
          noResults: () => 'No se encontraron resultados',
          inputTooShort: () => 'Por favor ingresa al menos 1 caracter'
        }
      });

      // Función para crear botón de eliminar
      function createRemoveButton() {
        return $('<button>')
          .addClass('btn btn-outline-danger remove-btn')
          .html('<i class="fas fa-times"></i>')
          .click(function() {
            const container = $(this).closest('.input-group, .social-item');
            container.fadeOut(function() {
              // Remover completamente el elemento del DOM después de la animación
              $(this).remove();
            });
          });
      }

      // Manejar enlaces externos
      $('#addLinkBtn').click(function() {
        const linkGroup = $('<div>').addClass('input-group mb-3')
          .append($('<input>')
            .addClass('form-control')
            .attr({
              type: 'url',
              name: 'links[]',
              placeholder: 'URL del enlace'
            }))
          .append(createRemoveButton());
        $('#linksContainer').append(linkGroup);
      });

      // Manejar redes sociales
      $('#addSocialBtn').click(function() {
        const socialItem = $('<div>').addClass('social-item mb-3')
          .append($('<div>').addClass('input-group')
            .append($('<select>')
              .addClass('form-select')
              .attr({
                name: 'social_platform[]',
                style: 'max-width: 150px'
              })
              .append(`
                <option value="Instagram">Instagram</option>
                <option value="Twitter">Twitter</option>
                <option value="Facebook">Facebook</option>
                <option value="TikTok">TikTok</option>
                <option value="Pinterest">Pinterest</option>
                <option value="Behance">Behance</option>
                <option value="Otro">Otro</option>
              `))
            .append($('<input>')
              .addClass('form-control')
              .attr({
                type: 'text',
                name: 'social_url[]',
                placeholder: '@usuario o URL'
              }))
            .append(createRemoveButton()));
          $('#socialContainer').append(socialItem);
      });

      // Manejar enlaces de video
      $('#addVideoLinkBtn').click(function() {
        const videoGroup = $('<div>').addClass('input-group mb-3')
          .append($('<input>')
            .addClass('form-control')
            .attr({
              type: 'url',
              name: 'video_urls[]',
              placeholder: 'URL del video'
            }))
          .append($('<button>')
            .addClass('btn btn-outline-danger remove-btn')
            .attr('type', 'button')
            .html('<i class="fas fa-times"></i>')
            .click(function() {
              $(this).closest('.input-group').remove();
            }));
        $('#videoLinksContainer').append(videoGroup);
      });

      // Inicializar botones de eliminar existentes
      $('.remove-btn').click(function() {
        const button = $(this);
        const container = button.closest('.input-group, .social-item');
        
        container.fadeOut(function() {
          // Remover completamente el elemento del DOM después de la animación
          $(this).remove();
        });
      });

      // Variables para almacenar elementos a eliminar
      let videosToDelete = [];  // Array para almacenar los videos a eliminar
      let imagesToDelete = [];  // Array para almacenar las imágenes a eliminar
      let targetToDelete = null; // Variable para almacenar el target a eliminar

      // Manejar eliminación de imágenes
      $('.delete-image').click(function() {
        const button = $(this);
        const imageUrl = button.data('image');
        const imageId = button.data('id');
        const imageType = button.data('type');
        const imageContainer = button.closest('.col-md-4, .card');

        if (confirm('¿Estás seguro de que deseas eliminar esta imagen?')) {
          // Ocultar la imagen visualmente
          imageContainer.fadeOut();
          
          // Agregar la imagen a la lista de eliminación
          imagesToDelete.push({
            id: imageId,
            url: imageUrl,
            type: imageType
          });

          // Agregar un campo oculto al formulario para enviar las imágenes a eliminar
          const hiddenInput = $('<input>')
            .attr({
              type: 'hidden',
              name: 'images_to_delete[]',
              value: JSON.stringify({ id: imageId, url: imageUrl, type: imageType })
            });
          $('form').append(hiddenInput);
        }
      });

      // Manejar eliminación de videos
      $('.delete-video').click(function() {
        const button = $(this);
        const videoUrl = button.data('video');
        const videoId = button.data('id');
        const videoContainer = button.closest('.mb-3, .input-group');

        if (confirm('¿Estás seguro de que deseas eliminar este video?')) {
          // Ocultar el video visualmente
          videoContainer.fadeOut(function() {
            // Remover completamente el elemento del DOM después de la animación
            $(this).remove();
          });
          
          // Agregar el video a la lista de eliminación
          videosToDelete.push({
            id: videoId,
            url: videoUrl
          });

          // Agregar un campo oculto al formulario para enviar los videos a eliminar
          const hiddenInput = $('<input>')
            .attr({
              type: 'hidden',
              name: 'videos_to_delete[]',
              value: JSON.stringify({ id: videoId, url: videoUrl })
            });
          $('form').append(hiddenInput);
        }
      });

      // Manejar eliminación de archivo target
      $('.delete-target').click(function() {
        const button = $(this);
        const targetUrl = button.data('target');
        const targetId = button.data('id');
        const targetContainer = button.closest('.card-body');

        if (confirm('¿Estás seguro de que deseas eliminar el archivo target? Deberás subir uno nuevo.')) {
          // Ocultar el target visualmente
          targetContainer.find('.d-flex.align-items-center').fadeOut();
          targetContainer.find('.d-flex.mb-2').fadeOut(function() {
            // Mostrar alerta de advertencia
            const alertDiv = $('<div class="alert alert-warning mb-3"><i class="fas fa-exclamation-triangle me-2"></i> Se eliminará el archivo target<small class="d-block mt-1 text-danger">* Debes subir uno nuevo</small></div>');
            $(this).after(alertDiv);
          });
          
          // Marcar el campo como requerido
          targetContainer.find('input[type="file"]').prop('required', true);
          
          // Agregar el target a eliminar
          targetToDelete = {
            id: targetId,
            url: targetUrl
          };

          // Agregar un campo oculto al formulario para enviar el target a eliminar
          const hiddenInput = $('<input>')
            .attr({
              type: 'hidden',
              name: 'target_to_delete',
              value: JSON.stringify({ id: targetId, url: targetUrl })
            });
          $('form').append(hiddenInput);
        }
      });

      // Función para manejar la vista previa del contenido principal
      document.getElementById('mainContentBasic').addEventListener('change', function(e) {
        const file = e.target.files[0];
        const container = this.closest('.card-body');
        const existingPreview = container.querySelector('.preview-content');
        
        if (file) {
          const reader = new FileReader();
          
          if (existingPreview) {
            existingPreview.remove();
          }
          
          if (file.type.startsWith('image/')) {
            const img = document.createElement('img');
            img.className = 'preview-content mb-3';
            img.style.maxWidth = '100%';
            reader.onload = function(e) {
              img.src = e.target.result;
            }
            if (container.firstChild) {
              container.insertBefore(img, container.firstChild);
            } else {
              container.appendChild(img);
            }
            reader.readAsDataURL(file);
          } else if (file.type.startsWith('video/')) {
            const video = document.createElement('video');
            video.className = 'preview-content mb-3';
            video.style.maxWidth = '100%';
            video.controls = true;
            reader.onload = function(e) {
              video.src = e.target.result;
            }
            if (container.firstChild) {
              container.insertBefore(video, container.firstChild);
            } else {
              container.appendChild(video);
            }
            reader.readAsDataURL(file);
          }
        }
      });

      // Sincronizar campos de contenido principal
      $('#mainContentBasic').on('change', function() {
        const fileInput = this;
        const mediaTab = $('#mainContentMedia');
        
        if (fileInput.files && fileInput.files.length > 0) {
          // Mostrar el nombre del archivo seleccionado
          const fileName = fileInput.files[0].name;
          mediaTab.attr('placeholder', fileName);
        }
      });

      // Vista previa de videos
      $('input[name="videoFiles"]').change(function(e) {
        const input = e.target;
        const container = $('#videoFilesContainer');

        if (input.files && input.files.length > 0) {
          Array.from(input.files).forEach(file => {
            const videoContainer = $('<div>').addClass('mb-3');
            const video = $('<video>')
              .addClass('video-preview')
              .attr({
                controls: true,
                style: 'max-width: 100%; max-height: 200px;'
              });
            const source = $('<source>').attr({
              src: URL.createObjectURL(file),
              type: file.type
            });
            video.append(source);
            videoContainer.append(video);
            container.append(videoContainer);
          });
        }
      });
    });
  </script>
</body>
</html> 